{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}CSV Import{% endblock %}
{% block breadcrumb %}Menu / CSV Import{% endblock %}

{% block content %}

<div class="detail-header">
  <div class="detail-header-left">
    <a href="{% url 'dashboard:menu_list' %}" class="back-link">‚Üê Back to Menu</a>
    <h2 class="detail-title">Bulk <span>CSV Import</span></h2>
  </div>
</div>

<div class="detail-grid">

  <!-- Left: Upload form -->
  <div style="display:flex;flex-direction:column;gap:1rem;">

    <div class="dash-card">
      <div class="dash-card-header"><span class="dash-card-title">Upload CSV File</span></div>
      <div class="form-body">

        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="csv-upload-area" id="csvUploadArea">
            <div class="upload-icon">üìÑ</div>
            <p class="upload-text">Click to upload your CSV file</p>
            <p class="upload-sub">Must be a .csv file</p>
            <input type="file" name="csv_file" accept=".csv" class="upload-input" id="csvInput" required>
          </div>

          <div id="csvFilename" style="display:none;margin-top:0.8rem;padding:0.75rem 1rem;background:var(--sand-light);border-left:3px solid var(--burnt);font-size:0.82rem;color:var(--charcoal);">
            üìÑ <span id="csvName"></span>
          </div>

          <div style="margin-top:1rem;display:flex;gap:0.8rem;">
            <button type="submit" class="btn-advance" style="flex:1;">Import Items ‚Üí</button>
            <a href="{% url 'dashboard:menu_csv_template' %}" class="btn-outline">‚¨á Download Template</a>
          </div>
        </form>

      </div>
    </div>

    <!-- Rules -->
    <div class="dash-card">
      <div class="dash-card-header"><span class="dash-card-title">Import Rules</span></div>
      <div class="form-body" style="font-size:0.82rem;line-height:1.8;color:var(--charcoal);">
        <p>‚Ä¢ If an item with the same name already exists, it will be <strong>updated</strong>, not duplicated.</p>
        <p>‚Ä¢ Categories are created automatically if they don't exist.</p>
        <p>‚Ä¢ Tags are created automatically if they don't exist.</p>
        <p>‚Ä¢ Images cannot be imported via CSV ‚Äî upload them individually after import.</p>
        <p>‚Ä¢ <code>is_available</code> and <code>is_featured</code> accept: <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code>, <code>yes</code></p>
      </div>
    </div>

  </div>

  <!-- Right: Format guide -->
  <div class="dash-card">
    <div class="dash-card-header"><span class="dash-card-title">CSV Format Guide</span></div>
    <div class="form-body">

      <p style="font-size:0.82rem;color:var(--mid);margin-bottom:1rem;">Required columns: <code>name</code>, <code>category</code>, <code>price</code></p>

      <div class="csv-columns">

        <div class="csv-col-row">
          <span class="csv-col-name">name</span>
          <span class="csv-col-req">Required</span>
          <span class="csv-col-desc">Item name. Duplicate names update existing items.</span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">category</span>
          <span class="csv-col-req">Required</span>
          <span class="csv-col-desc">Category name. Created if it doesn't exist.</span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">price</span>
          <span class="csv-col-req">Required</span>
          <span class="csv-col-desc">Numeric price e.g. <code>12.99</code></span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">description</span>
          <span class="csv-col-opt">Optional</span>
          <span class="csv-col-desc">Short description of the dish.</span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">is_available</span>
          <span class="csv-col-opt">Optional</span>
          <span class="csv-col-desc">Defaults to <code>true</code>. Use <code>false</code> to hide.</span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">is_featured</span>
          <span class="csv-col-opt">Optional</span>
          <span class="csv-col-desc">Defaults to <code>false</code>. Featured items show on homepage.</span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">tags</span>
          <span class="csv-col-opt">Optional</span>
          <span class="csv-col-desc">Pipe-separated: <code>Bestseller|Spicy|Chicken</code></span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">addons</span>
          <span class="csv-col-opt">Optional</span>
          <span class="csv-col-desc">Pipe-separated name:price pairs: <code>Extra Sauce:1.50|Extra Rice:2.00</code></span>
        </div>
        <div class="csv-col-row">
          <span class="csv-col-name">image</span>
          <span class="csv-col-opt">Optional</span>
          <span class="csv-col-desc">Filename only e.g. <code>chicken.jpg</code>. Upload images separately.</span>
        </div>
      </div>

      <div style="margin-top:1.5rem;background:var(--charcoal);padding:1rem;overflow-x:auto;">
        <p style="font-size:0.6rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--mid);margin-bottom:0.6rem;">Example CSV</p>
        <code style="font-size:0.72rem;color:var(--sand);white-space:nowrap;display:block;line-height:1.8;">
          name,category,price,description,is_available,is_featured,tags,addons,image<br>
          Crispy Chicken,Mains,12.99,Golden fried chicken,true,true,Bestseller|Chicken,Extra Sauce:1.50,chicken.jpg<br>
          Caesar Salad,Starters,8.50,Fresh romaine salad,true,false,Salad|Healthy,,<br>
          Mango Shake,Drinks,4.00,Fresh mango blended,true,false,Cold|Drinks,,
        </code>
      </div>

    </div>
  </div>

</div>

{% endblock %}

{% block extra_scripts %}
<script>
  const csvInput = document.getElementById('csvInput');
  const csvArea = document.getElementById('csvUploadArea');
  const csvFilename = document.getElementById('csvFilename');
  const csvName = document.getElementById('csvName');

  csvArea.addEventListener('click', () => csvInput.click());

  csvInput.addEventListener('change', () => {
    if (csvInput.files[0]) {
      csvName.textContent = csvInput.files[0].name;
      csvFilename.style.display = 'block';
    }
  });
</script>
{% endblock %}