<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Cart — Warm Vibe Bistro</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/cart.css' %}">
</head>
<body>

<!-- NAV -->
<nav class="site-nav">
  <a href="/" class="nav-logo">Warm Vibe Bistro</a>
  <div class="nav-links">
    <a href="{% url 'menu:menu' %}">Menu</a>
    <a href="{% url 'reservations:reservation' %}">Reservations</a>
    <a href="{% url 'orders:checkout' %}" class="nav-cta">Checkout</a>
  </div>
</nav>

<!-- PAGE HEADER -->
<div class="page-header">
  <div class="header-eyebrow">Takeout Order</div>
  <h1>Your <em>Cart</em></h1>
</div>

<!-- STEPS INDICATOR -->
<div class="steps">
  <div class="step active">Cart</div>
  <div class="step">Your Details</div>
  <div class="step">Confirmation</div>
</div>

<div class="container">
  <a href="{% url 'menu:menu' %}" class="back">← Continue browsing</a>

  {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="msg {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {% if cart.is_empty %}
    <p class="empty">Your cart is empty. <a href="{% url 'menu:menu' %}">Browse the menu →</a></p>
  {% else %}
    <div class="cart-layout">

      <!-- Items -->
      <div>
        <div class="section-label">Your Order</div>

        {% for item in cart %}
          <div class="cart-item">
            <div>
              <div class="item-name">{{ item.name }}</div>
              {% if item.addon_name %}<div class="item-addon">+ {{ item.addon_name }}</div>{% endif %}
              <div class="item-unit-price">₱{{ item.price }} each</div>
            </div>

            <form method="POST" class="qty-form">
              {% csrf_token %}
              <input type="hidden" name="key" value="{{ item.key }}">
              <input type="hidden" name="action" value="update">
              <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="20">
              <button type="submit" class="btn-update">Update</button>
            </form>

            <form method="POST">
              {% csrf_token %}
              <input type="hidden" name="key" value="{{ item.key }}">
              <input type="hidden" name="action" value="remove">
              <button type="submit" class="btn-remove">Remove</button>
            </form>

            <div class="item-total">₱{{ item.total }}</div>
          </div>
        {% endfor %}
      </div>

      <!-- Summary Panel -->
      <div class="summary-panel">
        <div class="section-label">Summary</div>

        <div class="promo-section">
          {% if promo_code %}
            <p class="promo-applied">✓ "{{ promo_code.code }}" — {{ promo_code.discount_percent }}% off</p>
          {% endif %}
          <form method="POST" class="promo-form">
            {% csrf_token %}
            {{ promo_form.promo_code }}
            <button type="submit">Apply</button>
          </form>
        </div>

        <hr class="divider">

        <div class="summary-row">
          <span>Subtotal</span>
          <span>₱{{ subtotal }}</span>
        </div>
        {% if promo_discount %}
          <div class="summary-row discount">
            <span>Discount</span>
            <span>−₱{{ promo_discount }}</span>
          </div>
        {% endif %}
        <div class="summary-row total-row">
          <span>Total</span>
          <span>₱{{ total }}</span>
        </div>

        <a href="{% url 'orders:checkout' %}" class="btn-checkout">Proceed to Checkout →</a>
        <p class="secure-note">Secure checkout · Pickup only</p>
      </div>

    </div>
  {% endif %}
</div>

</body>
</html>